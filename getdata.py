#python scripts
__author__='Du Jiawei'
#Descrption:
import numpy as np
import pandas as pd
from sklearn.model_selection import train_test_split
import csv
from keras.utils import np_utils, generic_utils
train_path = "/data/home/dujw/weitao/data/train.csv"
train_label_path = "/data/home/dujw/weitao/data/train_label.csv"
test_path = "/data/home/dujw/weitao/data/test.csv"
def get_data(size = 50000,test_size=0.2):
    data = []
    Y = []
    count = -1
    label = pd.read_csv(train_label_path,header = None).as_matrix()
    with open(train_path, "rb") as csvfile:
        datareader = csv.reader(csvfile)
        for row in datareader:
            count += 1
            row = np.array(row)
            if len(row)<=1024:
                zeros = np.zeros(1024)
                zeros[:len(row)] = row
                row = zeros
            if len(row)>1024:
                continue
            if count < size:
                data.append(row)
                Y.append(label[count,1])
            if count >=size:
                break
    X = np.array(data)
    Y = np.array(Y)
    # Y = np_utils.to_categorical(Y,2)
    x_train ,x_test, y_train,y_test = train_test_split(X,Y,test_size=test_size,random_state=42)
    return (x_train.astype(np.float32), y_train.astype(np.int8)),(x_test.astype(np.float32), y_test.astype(np.int8))
def pad(filename, limit):
    data = []
    count = 0
    with open(filename, "rb") as csvfile:
        datareader = csv.reader(csvfile)
        for row in datareader:
            row = np.asarray(row)
            if len(row) < 4096 :
                interm = np.zeros(4096)
                interm[:row.size] = row
                row = interm
            if len(row) > 4096:
                row =row[:4096]
            if count < limit:
                data.append(row)
            
            if count >=limit:
                data = np.asarray(data,float)
                return data
            count = count +1
    #     data = np.asarray(data,float)
    # return data

def label(filename, limit):
    print "breakkkkkkkkkkkkk"
    label = []
    count = 0
    with open(filename,'r') as lb:
        csv_reader = csv.reader(lb)
        for row in csv_reader:
            if count < limit:
                label.append(row)
            if count >= limit:
                label = np.asarray(label,float)  
                label[:,0] = 1 - label[:,1]
                return label
            count = count + 1


def get_pad(size = 10000,test_size = 0.2):
    train_data = pad('data/train.csv', size)
    train_label = label('data/train_label.csv', size)
    X = train_data
    Y = train_label
    x_train ,x_test, y_train,y_test = train_test_split(X,Y,test_size=test_size,random_state=42)
    return (x_train.astype(np.float32), y_train.astype(np.int8)),(x_test.astype(np.float32), y_test.astype(np.int8))



   
if __name__ == '__main__':
    (x1,y1),(t1,yt1) = get_data(size = 10)
    (x,y),(t,yt) = get_pad(size = 10)
    import pdb
    pdb.set_trace()
    

